/*
 * LCDdisplay.c
 *
 *  Created on: Jan 8, 2024
 *      Author: markus
 */

#include "LCDdisplay.h"



/*
 *
 *
 *  this is how to use the LCDdisplay
 *  call the first functions to initalize the LCD and save a
 *  location where to save the memory of the LCD then use StringAdd
 *  like shown
 *
 *  stringAdd(LCD, "some string", xpos, ypos);
 *
 *  the LCD always has to be in there or it wont work

	uint8_t* LCD = initalize_LCD();
	stringAdd(LCD,"SCORE : 1050",0,2);
	free(LCD);
*/

uint8_t* initalize_LCD(){
	lcd_init();
	uint8_t* LCD = (uint8_t*) malloc(512);
	LCDclrscrn(LCD,0);


	return LCD;
}

void LCD_gameStart(uint8_t* LCD){
	char hearts[4] = {128, 128, 128};
	char bullets[6] = {130, 130, 130, 130, 130};

	stringAdd(LCD, hearts,0,0 );
	stringAdd(LCD, "Score: 0",0,1 );
	stringAdd(LCD, bullets,0,3);
}


void setScore(uint8_t* LCD, uint8_t amount){

	char* input = (char*) malloc(20*sizeof(char));
	sprintf(input, "%d", amount);

	LCDclrline(LCD, 1);


	int length = strlen(input);

	char string[20] = "Score: ";

	for(int i =0; i < length; i++){
		string[i+7] = input[i];
	}
	stringAdd(LCD, string,0,1 );

	free(input);


}




void bulletamount(uint8_t* LCD, uint8_t amount){



	switch(amount){
	case 0:
		bullet0(LCD);
		break;
	case 1:
		bullet1(LCD);
		break;
	case 2:
		bullet2(LCD);
		break;
	case 3:
		bullet3(LCD);
		break;
	case 4:
		bullet4(LCD);
		break;
	case 5:
		bullet5(LCD);
		break;
	case 6:
		bullet6(LCD);
		break;
	case 7:
		bullet7(LCD);
		break;
	default:
		bullet8(LCD);
	}
}

void bullet0(uint8_t* LCD){
	char bullets[9] = {129, 129, 129, 129, 129, 129, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet1(uint8_t* LCD){
	char bullets[9] = {130, 129, 129, 129, 129, 129, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet2(uint8_t* LCD){
	char bullets[9] = {130, 130, 129, 129, 129, 129, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet3(uint8_t* LCD){
	char bullets[9] = {130, 130, 130, 129, 129, 129, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet4(uint8_t* LCD){
	char bullets[9] = {130, 130, 130, 130, 129, 129, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet5(uint8_t* LCD){
	char bullets[9] = {130, 130, 130, 130, 130, 129, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet6(uint8_t* LCD){
	char bullets[9] = {130, 130, 130, 130, 130, 130, 129, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet7(uint8_t* LCD){
	char bullets[9] = {130, 130, 130, 130, 130, 130, 130, 129};
	stringAdd(LCD, bullets,0,3 );
}
void bullet8(uint8_t* LCD){
	char bullets[9] = {130, 130, 130, 130, 130, 130, 130, 130};
	stringAdd(LCD, bullets,0,3 );
}





void healthamount(uint8_t* LCD, uint8_t amount){

	switch(amount){
	case 0:
		heart0(LCD);
		break;
	case 1:
		heart1(LCD);
		break;
	case 2:
		heart2(LCD);
		break;
	case 3:
		heart3(LCD);
		break;
	default:
		heart3(LCD);
	}
}


void heart0(uint8_t* LCD){
	char hearts[4] = {127, 127, 127};
	stringAdd(LCD, hearts,0,0 );

}

void heart1(uint8_t* LCD){
	char hearts[4] = {128, 127, 127};
	stringAdd(LCD, hearts,0,0 );

}
void heart2(uint8_t* LCD){
	char hearts[4] = {128, 128, 127};
	stringAdd(LCD, hearts,0,0 );

}
void heart3(uint8_t* LCD){
	char hearts[4] = {128, 128, 128};
	stringAdd(LCD, hearts,0,0 );

}






char heart[5] = {0x0E, 0x11, 0x22, 0x11, 0x0E};


void stringAdd(uint8_t* LCD, char* text, uint8_t x, uint8_t y){

	uint8_t length = strlen(text);

	x = x%(128);
	y = y%4;

	uint16_t arr[ 20 ];
	memset(arr,0,10);


	for(int p = 0; p < length; p++){
		arr[p] = ((uint16_t) text[p] - 32);
	}

	for(int i = 0; i < length; i++){
		LCD[ i*5  + 0 + x + y*128] = character_data[ arr[i] ][0];
		LCD[(i*5) + 1 + x + y*128] = character_data[ arr[i] ][1];
		LCD[(i*5) + 2 + x + y*128] = character_data[ arr[i] ][2];
		LCD[(i*5) + 3 + x + y*128] = character_data[ arr[i] ][3];
		LCD[(i*5) + 4 + x + y*128] = character_data[ arr[i] ][4];
	}
	lcd_push_buffer(LCD);
}







void drawHearts(uint8_t num, uint8_t x, uint8_t y){

	x = x%(128);
	y = y%4;


	uint8_t format[128];
	memset(format,0,128);


	for(int i = 0; i < 4; i++){
		format[ i*5  + 0 + x + y*128] = heart[0];
		format[(i*5) + 1 + x + y*128] = heart[1];
		format[(i*5) + 2 + x + y*128] = heart[2];
		format[(i*5) + 3 + x + y*128] = heart[3];
		format[(i*5) + 4 + x + y*128] = heart[4];
	}
	lcd_push_buffer(format);
}


void LCDclrline(uint8_t *LCD,uint8_t liney){

	for(int i= 0; i < 128; i++){
		LCD[i+liney*128] = 0;
	}

	lcd_push_buffer(LCD);
}


void LCDclrscrn(uint8_t *LCD,uint8_t fill){
	memset(LCD, fill, 512);
	lcd_push_buffer(LCD);
}







//the first 95 are characters and the data[95] is the heart and data[96 is full heart]
const char character_data[99][5] = {
  {0x00, 0x00, 0x00, 0x00, 0x00},
  {0x00, 0x5F, 0x5F, 0x00, 0x00},
  {0x00, 0x07, 0x00, 0x07, 0x00},
  {0x14, 0x7F, 0x14, 0x7F, 0x14},
  {0x24, 0x2A, 0x7F, 0x2A, 0x12},
  {0x23, 0x13, 0x08, 0x64, 0x62},
  {0x36, 0x49, 0x55, 0x22, 0x50},
  {0x00, 0x05, 0x03, 0x00, 0x00},
  {0x00, 0x1C, 0x22, 0x41, 0x00},
  {0x00, 0x41, 0x22, 0x1C, 0x00},
  {0x14, 0x08, 0x3E, 0x08, 0x14},
  {0x08, 0x08, 0x3E, 0x08, 0x08},
  {0x00, 0x50, 0x30, 0x00, 0x00},
  {0x08, 0x08, 0x08, 0x08, 0x08},
  {0x00, 0x60, 0x60, 0x00, 0x00},
  {0x20, 0x10, 0x08, 0x04, 0x02},
  {0x3E, 0x51, 0x49, 0x45, 0x3E},
  {0x00, 0x42, 0x7F, 0x40, 0x00},
  {0x42, 0x61, 0x51, 0x49, 0x46},
  {0x22, 0x49, 0x49, 0x49, 0x36},
  {0x18, 0x14, 0x12, 0x7F, 0x10},
  {0x2F, 0x49, 0x49, 0x49, 0x31},
  {0x3E, 0x49, 0x49, 0x49, 0x32},
  {0x03, 0x01, 0x71, 0x09, 0x07},
  {0x36, 0x49, 0x49, 0x49, 0x36},
  {0x26, 0x49, 0x49, 0x49, 0x3E},
  {0x00, 0x36, 0x36, 0x00, 0x00},
  {0x00, 0x56, 0x36, 0x00, 0x00},
  {0x08, 0x14, 0x22, 0x41, 0x00},
  {0x14, 0x14, 0x14, 0x14, 0x14},
  {0x00, 0x41, 0x22, 0x14, 0x08},
  {0x02, 0x01, 0x51, 0x09, 0x06},
  {0x32, 0x49, 0x79, 0x41, 0x3E},
  {0x7C, 0x0A, 0x09, 0x0A, 0x7C},
  {0x7F, 0x49, 0x49, 0x49, 0x36},
  {0x3E, 0x41, 0x41, 0x41, 0x22},
  {0x7F, 0x41, 0x41, 0x41, 0x3E},
  {0x7F, 0x49, 0x49, 0x49, 0x41},
  {0x7F, 0x09, 0x09, 0x09, 0x01},
  {0x3E, 0x41, 0x49, 0x49, 0x7A},
  {0x7F, 0x08, 0x08, 0x08, 0x7F},
  {0x00, 0x41, 0x7F, 0x41, 0x00},
  {0x30, 0x40, 0x40, 0x40, 0x3F},
  {0x7F, 0x08, 0x14, 0x22, 0x41},
  {0x7F, 0x40, 0x40, 0x40, 0x40},
  {0x7F, 0x02, 0x0C, 0x02, 0x7F},
  {0x7F, 0x02, 0x04, 0x08, 0x7F},
  {0x3E, 0x41, 0x41, 0x41, 0x3E},
  {0x7F, 0x09, 0x09, 0x09, 0x06},
  {0x3E, 0x41, 0x51, 0x21, 0x5E},
  {0x7F, 0x09, 0x09, 0x09, 0x76},
  {0x26, 0x49, 0x49, 0x49, 0x32},
  {0x01, 0x01, 0x7F, 0x01, 0x01},
  {0x3F, 0x40, 0x40, 0x40, 0x3F},
  {0x1F, 0x20, 0x40, 0x20, 0x1F},
  {0x3F, 0x40, 0x38, 0x40, 0x3F},
  {0x63, 0x14, 0x08, 0x14, 0x63},
  {0x03, 0x04, 0x78, 0x04, 0x03},
  {0x61, 0x51, 0x49, 0x45, 0x43},
  {0x7F, 0x41, 0x41, 0x00, 0x00},
  {0x02, 0x04, 0x08, 0x10, 0x20},
  {0x00, 0x41, 0x41, 0x7F, 0x00},
  {0x04, 0x02, 0x01, 0x02, 0x04},
  {0x40, 0x40, 0x40, 0x40, 0x40},
  {0x00, 0x01, 0x02, 0x04, 0x00},
  {0x20, 0x54, 0x54, 0x54, 0x78},
  {0x7F, 0x48, 0x44, 0x44, 0x38},
  {0x38, 0x44, 0x44, 0x44, 0x20},
  {0x38, 0x44, 0x44, 0x48, 0x7F},
  {0x38, 0x54, 0x54, 0x54, 0x18},
  {0x08, 0x7E, 0x09, 0x01, 0x02},
  {0x0C, 0x52, 0x52, 0x52, 0x3E},
  {0x7F, 0x08, 0x04, 0x04, 0x78},
  {0x00, 0x44, 0x7D, 0x40, 0x00},
  {0x20, 0x40, 0x44, 0x3D, 0x00},
  {0x7F, 0x10, 0x28, 0x44, 0x00},
  {0x00, 0x41, 0x7F, 0x40, 0x00},
  {0x7C, 0x04, 0x18, 0x04, 0x78},
  {0x7C, 0x08, 0x04, 0x04, 0x78},
  {0x38, 0x44, 0x44, 0x44, 0x38},
  {0x7C, 0x14, 0x14, 0x14, 0x08},
  {0x08, 0x14, 0x14, 0x18, 0x7C},
  {0x7C, 0x08, 0x04, 0x04, 0x08},
  {0x48, 0x54, 0x54, 0x54, 0x20},
  {0x04, 0x3F, 0x44, 0x40, 0x20},
  {0x3C, 0x40, 0x40, 0x20, 0x7C},
  {0x1C, 0x20, 0x40, 0x20, 0x1C},
  {0x3C, 0x40, 0x38, 0x40, 0x3C},
  {0x44, 0x28, 0x10, 0x28, 0x44},
  {0x0C, 0x50, 0x50, 0x50, 0x3C},
  {0x44, 0x64, 0x54, 0x4C, 0x44},
  {0x00, 0x08, 0x36, 0x41, 0x00},
  {0x00, 0x00, 0x7F, 0x00, 0x00},
  {0x00, 0x41, 0x36, 0x08, 0x00},
  {0x08, 0x04, 0x08, 0x10, 0x08},
  {0x0E, 0x11, 0x22, 0x11, 0x0E},
  {0x0E, 0x1F, 0x7E, 0x1F, 0x0E},
  {0xF8, 0x86, 0x81, 0x86, 0xF8},
  {0xF8, 0xFE, 0xFF, 0xFE, 0xF8}
};


